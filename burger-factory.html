<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Burger Flow: Simulation Lean Management</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        'floor-kitchen': '#e5e7eb', // gray-200
                        'floor-dining': '#d4c5a9', // beige timber
                    },
                    keyframes: {
                        'fade-in-up': {
                            '0%': { opacity: '0', transform: 'translateY(10px)' },
                            '100%': { opacity: '1', transform: 'translateY(0)' },
                        }
                    },
                    animation: {
                        'fade-in-up': 'fade-in-up 0.5s ease-out'
                    }
                }
            }
        }
    </script>

    <!-- React & Babel -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <style>
        body {
            background-color: #f3f4f6;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        /* Motif sol cuisine (carrelage technique) */
        .bg-pattern-kitchen {
            background-image: 
                linear-gradient(45deg, #ccc 25%, transparent 25%), 
                linear-gradient(-45deg, #ccc 25%, transparent 25%), 
                linear-gradient(45deg, transparent 75%, #ccc 75%), 
                linear-gradient(-45deg, transparent 75%, #ccc 75%);
            background-size: 20px 20px;
            background-position: 0 0, 0 10px, 10px -10px, -10px 0px;
            opacity: 0.1;
        }
        
        /* --- ANIMATIONS DE FLUX TENDU (Calibrées sur les nouveaux points de connexion) --- */
        
        /* Stock Sec (Haut G) -> Toaster (Haut Col 2) */
        @keyframes stockDryToToaster { 
            0% { left: 10%; top: 18%; opacity: 0; transform: scale(0.5); } 
            20% { opacity: 1; transform: scale(1); } 
            90% { opacity: 1; transform: scale(1); }
            100% { left: 24%; top: 18%; opacity: 0; transform: scale(0.8); } 
        }

        /* Chambre Froide (Bas G) -> Grill (Milieu Col 2) */
        @keyframes stockColdToGrill { 
            0% { left: 10%; top: 65%; opacity: 0; transform: scale(0.5); } 
            20% { opacity: 1; transform: scale(1); } 
            50% { left: 15%; top: 45%; }
            100% { left: 24%; top: 45%; opacity: 0; transform: scale(0.8); } 
        }

        /* Chambre Froide (Bas G) -> Frites (Bas Col 2) */
        @keyframes stockColdToFryStation {
            0% { left: 10%; top: 65%; opacity: 0; transform: scale(0.5); } 
            20% { opacity: 1; transform: scale(1); } 
            100% { left: 24%; top: 72%; opacity: 0; transform: scale(0.8); } 
        }

        /* Toaster (Haut) -> Prep (Centre) */
        @keyframes toasterToPrep { 
            0% { left: 32%; top: 18%; opacity: 1; } 
            100% { left: 47%; top: 35%; opacity: 0; } 
        }
        
        /* Grill (Milieu) -> Prep (Centre) */
        @keyframes grillToPrep { 
            0% { left: 32%; top: 45%; opacity: 1; } 
            100% { left: 47%; top: 45%; opacity: 0; } 
        }

        /* Garniture (Simulé) -> Prep */
        @keyframes garnishToPrep {
            0% { left: 10%; top: 30%; opacity: 0; transform: scale(0.5); }
            100% { left: 47%; top: 40%; opacity: 0; transform: scale(0.5); }
        }

        /* Prep -> Runner (Droite) */
        @keyframes burgerToRunner { 
            0% { left: 60%; top: 40%; opacity: 1; } 
            100% { left: 74%; top: 40%; opacity: 0; } 
        }
        
        /* Frites (Bas) -> Runner (Droite) */
        @keyframes friesToRunner { 
            0% { left: 32%; top: 72%; opacity: 1; } 
            50% { left: 60%; top: 72%; }
            100% { left: 74%; top: 45%; opacity: 0; } 
        }
        
        /* Runner -> Counter */
        @keyframes trayToCounter { 
            0% { left: 82%; top: 40%; opacity: 1; transform: scale(1); } 
            100% { left: 93%; top: 40%; opacity: 0; transform: scale(0.6); } 
        }
        
        .animate-stock-to-grill { animation: stockColdToGrill 1s forwards ease-in-out; }
        .animate-stock-to-toaster { animation: stockDryToToaster 1s forwards ease-in-out; }
        .animate-stock-to-fry { animation: stockColdToFryStation 1.2s forwards ease-in-out; }
        .animate-grill-to-prep { animation: grillToPrep 0.8s forwards ease-in-out; }
        .animate-toaster-to-prep { animation: toasterToPrep 0.8s forwards ease-in-out; }
        .animate-garnish-to-prep { animation: garnishToPrep 0.8s forwards ease-in-out; }
        .animate-burger-to-runner { animation: burgerToRunner 0.8s forwards ease-in-out; }
        .animate-fries-to-runner { animation: friesToRunner 1.2s forwards ease-in-out; }
        .animate-tray-to-counter { animation: trayToCounter 1s forwards ease-in-out; }

    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef } = React;

        // --- BIBLIOTHÈQUE D'ICÔNES SVG ---
        const ICONS_PATHS = {
            ChefHat: <path d="M6 13.87A4 4 0 0 1 7.41 6a5.11 5.11 0 0 1 1.05-1.54 5 5 0 0 1 9.08 0A5.11 5.11 0 0 1 18.59 6 4 4 0 0 1 20 13.87V21H6Z M6 17h14" />,
            Utensils: <path d="M3 2v7c0 1.1.9 2 2 2h4a2 2 0 0 0 2-2V2 M7 2v20 M21 15V2v0a5 5 0 0 0-5 5v6c0 1.1.9 2 2 2h3Zm0 0v7" />,
            Clock: <><circle cx="12" cy="12" r="10" /><polyline points="12 6 12 12 16 14" /></>,
            Users: <><path d="M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2" /><circle cx="9" cy="7" r="4" /><path d="M22 21v-2a4 4 0 0 0-3-3.87" /><path d="M16 3.13a4 4 0 0 1 0 7.75" /></>,
            Thermometer: <path d="M14 4v10.54a4 4 0 1 1-4 0V4a2 2 0 0 1 4 0Z" />,
            CheckCircle: <><path d="M22 11.08V12a10 10 0 1 1-5.93-9.14" /><polyline points="22 4 12 14.01 9 11.01" /></>,
            Play: <polygon points="5 3 19 12 5 21 5 3" />,
            Pause: <><rect x="6" y="4" width="4" height="16" /><rect x="14" y="4" width="4" height="16" /></>,
            Box: <path d="M21 16V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16z M3.27 6.96 12 12.01l8.73-5.05 M12 22.08V12" />,
            Flame: <path d="M8.5 14.5A2.5 2.5 0 0 0 11 12c0-1.38-.5-2-1-3-1.072-2.143-.224-4.054 2-6 .5 2.5 2 4.9 4 6.5 2 1.6 3 3.5 3 5.5a7 7 0 1 1-14 0c0-1.1.2-2.2.5-3.3.3-1.09.9-2.2 1.9-3.3.4 2.5 1.5 4.5 1.1 6.6Z" />,
            Sandwich: <><path d="M3 11v3a1 1 0 0 0 1 1h16a1 1 0 0 0 1-1v-3" /><path d="M12 19H4a1 1 0 0 1-1-1v-2a1 1 0 0 1 1-1h16a1 1 0 0 1 1 1v2a1 1 0 0 1-1 1h-3.83" /><path d="m3 11 7.77-6.04a2 2 0 0 1 2.46 0L21 11H3Z" /><path d="M12.97 19.77 7 15h12.5l-3.75 4.5a2 2 0 0 1-2.78.27Z" /></>,
            ArrowRight: <><line x1="5" y1="12" x2="19" y2="12" /><polyline points="12 5 19 12 12 19" /></>,
            ArrowLeft: <><line x1="19" y1="12" x2="5" y2="12" /><polyline points="12 19 5 12 12 5" /></>,
            Home: <><path d="m3 9 9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z" /><polyline points="9 22 9 12 15 12 15 22" /></>,
            User: <><path d="M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2" /><circle cx="12" cy="7" r="4" /></>,
            Snowflake: <><line x1="2" y1="12" x2="22" y2="12" /><line x1="12" y1="2" x2="12" y2="22" /><path d="m20 16-4-4 4-4" /><path d="m4 8 4 4-4 4" /><path d="m16 4-4 4-4-4" /><path d="m8 20 4-4 4 4" /></>,
            Package: <><path d="m16.5 9.4-9-5.19" /><path d="m21 16V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16z" /><polyline points="3.27 6.96 12 12.01 20.73 6.96" /><line x1="12" y1="22.08" x2="12" y2="12" /></>,
            Waves: <path d="M2 6c.6.5 1.2 1 2.5 1C7 7 7 5 9.5 5c2.6 0 2.4 2 5 2 2.5 0 2.5-2 5-2 1.3 0 1.9.5 2.5 1 M2 12c.6.5 1.2 1 2.5 1 2.5 0 2.5-2 5-2 2.6 0 2.4 2 5 2 2.5 0 2.5-2 5-2 1.3 0 1.9.5 2.5 1 M2 18c.6.5 1.2 1 2.5 1 2.5 0 2.5-2 5-2 2.6 0 2.4 2 5 2 2.5 0 2.5-2 5-2 1.3 0 1.9.5 2.5 1" />,
            Briefcase: <><rect x="2" y="7" width="20" height="14" rx="2" ry="2" /><path d="M16 21V5a2 2 0 0 0-2-2h-4a2 2 0 0 0-2 2v16" /></>,
            HelpCircle: <><circle cx="12" cy="12" r="10" /><path d="M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3" /><line x1="12" y1="17" x2="12.01" y2="17" /></>,
            Info: <><circle cx="12" cy="12" r="10" /><line x1="12" y1="16" x2="12" y2="12" /><line x1="12" y1="8" x2="12.01" y2="8" /></>,
            ShoppingBag: <><path d="M6 2 3 6v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2V6l-3-4Z" /><line x1="3" y1="6" x2="21" y2="6" /><path d="M16 10a4 4 0 0 1-8 0" /></>,
            Tray: <rect x="2" y="10" width="20" height="10" rx="2" />,
            Tomato: <circle cx="12" cy="12" r="8" fill="currentColor" fillOpacity="0.4" strokeWidth="2" />,
            Lettuce: <path d="M12 2C8 2 6 4 6 6c0 1.5 1 2.5 2 3 .5-1 1.5-2 3-2s3 2 4 3c1-.5 2-1.5 2-3 0-2-2-4-5-5Z" />,
            Layout: <><rect x="3" y="3" width="18" height="18" rx="2" /><line x1="3" y1="9" x2="21" y2="9" /><line x1="9" y1="21" x2="9" y2="9" /></>
        };

        const Icon = ({ name, size = 24, className, ...props }) => {
            const content = ICONS_PATHS[name];
            if (!content) return null;
            return (
                <svg
                    xmlns="http://www.w3.org/2000/svg"
                    width={size}
                    height={size}
                    viewBox="0 0 24 24"
                    fill="none"
                    stroke="currentColor"
                    strokeWidth="2"
                    strokeLinecap="round"
                    strokeLinejoin="round"
                    className={className}
                    {...props}
                >
                    {content}
                </svg>
            );
        };

        // --- STANDARDS ---
        const STATION_STANDARDS = {
            layout_general: {
                title: "Organisation Optimale d'une Cuisine",
                content: [
                    "Principe du 'Speedee Service' : Minimiser les pas.",
                    "Zonage : Zone Chaude (Grill/Frites) vs Zone Froide (Assemblage).",
                    "Flux : De l'arrière (Stock) vers l'avant (Comptoir) sans croisement.",
                    "Ergonomie : Postes 'clamshell' et 'MFY' pour réduire les gestes.",
                    "La clé : Le produit avance toujours vers le client."
                ]
            },
            stock_cold: { 
                title: "Chambre Froide / Congélateur", 
                content: [
                    "Rotation FIFO (First In, First Out) stricte.",
                    "Traçabilité : Dates limites affichées.",
                    "Surgelé (-18°C) pour Steaks (100% bœuf) et Frites.",
                    "Frais (+4°C) pour Salades/Fromage.",
                    "Organisation visuelle (Étiquettes couleur)."
                ] 
            },
            stock_dry: {
                title: "Stockage Sec (Réserve)",
                content: [
                    "Gestion 5S (Une place pour chaque chose).",
                    "Stockage Pains, Sauces, Emballages.",
                    "Flux tendu (Just-In-Time) : Livraisons fréquentes.",
                    "Contrôle stocks hebdomadaire.",
                    "Proximité zone de livraison."
                ]
            },
            grill: { 
                title: "Grill Clamshell (Double-Face)", 
                content: [
                    "Technologie : Cuisson bilatérale (haut/bas).",
                    "Temps Standard : ~38-42 sec (Steak 45g) à ~200°C.",
                    "Sécurité : Température interne > 69°C (anti-bactérie).",
                    "Process : Aucun ajout de gras, Salage/Poivrage après cuisson.",
                    "Nettoyage : Raclage après chaque tournée."
                ] 
            },
            toaster: { 
                title: "Toaster Vertical Rapide", 
                content: [
                    "Temps de passage : 15 à 22 secondes.",
                    "Caramélisation : Rend la mie imperméable aux sauces.",
                    "Tri automatique : Couronne (haut) et Talon (bas).",
                    "Réglage température fixe pour dorure constante.",
                    "Maintien au chaud (buffer) limité."
                ] 
            },
            frites: { 
                title: "Station Frites Automatisée", 
                content: [
                    "Standardisation : Partenariat J.R. Simplot (1967) pour frites calibrées surgelées.",
                    "Cuisson : Automatique (3 min à 175°C) avec relevage panier auto.",
                    "Qualité : Salage en 'W' pour répartition homogène.",
                    "Hold Time : Jetées si > 7 min en bac (garantie fraîcheur).",
                    "Filtrage huile quotidien."
                ] 
            },
            assembly: { 
                title: "Table de Préparation (MFY)", 
                content: [
                    "Système 'Made For You' (1998) : Assemblage à la commande (Flux tiré).",
                    "Ergonomie : Tous ingrédients à portée de main.",
                    "Poka-Yoke : Pistolets à sauce délivrant la dose exacte (10ml/5ml).",
                    "Standard : Ordre d'empilage strict (Pain > Sauce > Oignon > Cornichon > Fromage > Viande).",
                    "KDS (Kitchen Display System) : Écrans remplaçant les tickets papier."
                ] 
            },
            menu: { 
                title: "Runner / Expéditeur", 
                content: [
                    "Rôle : Consolidation finale (Burger + Frites + Boisson).",
                    "Contrôle : Vérification visuelle de la commande (Accuracy).",
                    "Précision : Balances connectées (IA) pour poids sacs.",
                    "Priorisation : Commandes sur place vs Livraison.",
                    "Objectif : Service complet < 90s."
                ] 
            },
            counter: {
                title: "Comptoir & Service",
                content: [
                    "Philosophie QSC&V : Qualité, Service, Propreté, Valeur.",
                    "Accueil : Standardisé (Sourire, 'Bonjour', Prise de congé).",
                    "Gestion Flux : Séparation Prise commande / Retrait.",
                    "Omnicanal : Gestion fluide des bornes et du comptoir.",
                    "Satisfaction : Mesure continue via enquêtes clients."
                ]
            }
        };

        // --- COMPOSANTS UI ---

        const SimulationStation = ({ name, status, onClick, progress, iconName, color, className = "", type, onShowStandard, showInfoButton = false, disabled = false }) => {
          return (
            <div className={`relative p-1 rounded-sm border-2 flex flex-col items-center justify-center transition-all shadow-sm z-10 bg-white ${className} ${status === 'cooking' ? 'border-orange-400' : 'border-gray-300'} ${status === 'done' ? 'border-green-500 ring-1 ring-green-300' : ''}`}>
              {showInfoButton && (
                  <button onClick={(e) => { e.stopPropagation(); onShowStandard(); }} className="absolute -top-2 -right-2 bg-blue-50 text-blue-600 border border-blue-200 rounded-full p-0.5 z-20 hover:scale-110 shadow-sm"><Icon name="Info" size={12} /></button>
              )}
              {/* Point de connexion GAUCHE (Arrivée) */}
              <div className="absolute left-[-4px] top-1/2 transform -translate-y-1/2 w-2 h-2 bg-slate-400 rounded-full border border-white z-0"></div>
              {/* Point de connexion DROITE (Départ) */}
              <div className="absolute right-[-4px] top-1/2 transform -translate-y-1/2 w-2 h-2 bg-slate-400 rounded-full border border-white z-0"></div>

              <button onClick={onClick} disabled={disabled || status === 'cooking'} 
                className={`w-full h-full flex flex-col items-center justify-center relative overflow-hidden ${disabled ? 'opacity-40 cursor-not-allowed' : 'hover:bg-gray-50 cursor-pointer'}`}>
                
                <div className={`p-2 rounded-full transition-colors mb-1 z-10 ${status === 'empty' ? color : 'bg-gray-100'} ${status === 'cooking' ? 'animate-pulse' : ''}`}>
                    <Icon name={iconName} size={20} className={status === 'empty' ? "text-white" : "text-gray-700"} />
                </div>
                
                <span className="font-bold text-[9px] text-center uppercase text-gray-600 leading-none z-10">{name}</span>
                
                {status === 'cooking' && (
                    <div className="absolute bottom-0 left-0 right-0 h-1.5 bg-gray-100">
                        <div className="bg-orange-500 h-full transition-all duration-100 ease-linear" style={{ width: `${progress}%` }}></div>
                    </div>
                )}
                
                {status === 'done' && <div className="absolute top-0 right-0 p-0.5 z-20"><Icon name="CheckCircle" size={14} className="text-green-500 bg-white rounded-full" /></div>}
              </button>
            </div>
          );
        };

        // --- APPLICATION PRINCIPALE ---

        function BurgerFactoryApp() {
          const [gameState, setGameState] = useState('intro'); 
          const [isPaused, setIsPaused] = useState(false);
          const [score, setScore] = useState(0);
          const [feedback, setFeedback] = useState(null);
          
          const [burgersMade, setBurgersMade] = useState(0);
          
          const [grillStatus, setGrillStatus] = useState({ state: 'empty', progress: 0 }); 
          const [toasterStatus, setToasterStatus] = useState({ state: 'empty', progress: 0 });
          const [fritesStatus, setFritesStatus] = useState({ state: 'empty', progress: 0 });
          const [prepStatus, setPrepStatus] = useState({ state: 'empty', progress: 0 }); 
          const [menuStatus, setMenuStatus] = useState({ state: 'empty', progress: 0 }); 
          
          const [showHelp, setShowHelp] = useState(false);
          const [explanationTarget, setExplanationTarget] = useState(null); 
          
          const [movingItems, setMovingItems] = useState([]); 
          const [clients, setClients] = useState(3); 

          const timerRef = useRef(null);
          const gameLoopRef = useRef(null);
          const clientGenRef = useRef(null);

          const spawnMovingItem = (type) => {
              const id = Date.now() + Math.random();
              setMovingItems(prev => [...prev, { id, type }]);
              let duration = 850;
              if (['steak_raw', 'bun_raw', 'fries_raw', 'tray_final', 'stock_to_fry'].includes(type)) duration = 1000;
              // Frites vers Runner
              if (type === 'fries_to_runner') duration = 1200;
              setTimeout(() => setMovingItems(prev => prev.filter(i => i.id !== id)), duration); 
          };

          const handlePrepAssembly = () => {
            if (grillStatus.state === 'done' && toasterStatus.state === 'done') {
                spawnMovingItem('parts_to_prep'); 
                spawnMovingItem('garnish_to_prep'); 
                
                setGrillStatus({ state: 'empty', progress: 0 });
                setToasterStatus({ state: 'empty', progress: 0 });
                setPrepStatus({ state: 'cooking', progress: 0 });
            } else {
                setFeedback({ type: 'error', msg: "Il faut le Pain toasté ET la Viande cuite !" });
                setTimeout(() => setFeedback(null), 1000);
            }
          };

          const handleRunnerAssembly = () => {
              if (prepStatus.state === 'done' && fritesStatus.state === 'done') {
                  if (clients > 0) {
                    spawnMovingItem('burger_to_runner');
                    spawnMovingItem('fries_to_runner');
                    setPrepStatus({ state: 'empty', progress: 0 });
                    setFritesStatus({ state: 'empty', progress: 0 });
                    setMenuStatus({ state: 'cooking', progress: 0 });
                  } else {
                    setFeedback({ type: 'error', msg: "Pas de client en attente !" });
                    setTimeout(() => setFeedback(null), 1000);
                  }
              } else {
                   setFeedback({ type: 'error', msg: "Menu incomplet (Burger + Frites requis) !" });
                   setTimeout(() => setFeedback(null), 1000);
              }
          };

          useEffect(() => {
            if ((gameState === 'simulation') && !showHelp && !explanationTarget && !isPaused) {
              clientGenRef.current = setInterval(() => setClients(c => c < 8 ? c + 1 : c), 6000); 

              gameLoopRef.current = setInterval(() => {
                 const standardTick = 1.5;
                 
                 if (grillStatus.state === 'cooking') setGrillStatus(p => p.progress >= 100 ? { state: 'done', progress: 100 } : { ...p, progress: p.progress + standardTick });
                 if (toasterStatus.state === 'cooking') setToasterStatus(p => p.progress >= 100 ? { state: 'done', progress: 100 } : { ...p, progress: p.progress + (standardTick * 1.5) }); 
                 if (fritesStatus.state === 'cooking') setFritesStatus(p => p.progress >= 100 ? { state: 'done', progress: 100 } : { ...p, progress: p.progress + (standardTick * 0.8) }); 
                 if (prepStatus.state === 'cooking') setPrepStatus(p => p.progress >= 100 ? { state: 'done', progress: 100 } : { ...p, progress: p.progress + (standardTick * 2) }); 
                 
                 if (menuStatus.state === 'cooking') {
                     setMenuStatus(prev => {
                         if (prev.progress >= 100) {
                            setTimeout(() => {
                                setMenuStatus({ state: 'empty', progress: 0 });
                                spawnMovingItem('tray_final'); 
                                setBurgersMade(b => b + 1);
                                setClients(c => Math.max(0, c - 1));
                                setScore(s => s + 70 + (clients * 10)); 
                            }, 300);
                            return { state: 'cooking', progress: 100 };
                         }
                         return { ...prev, progress: prev.progress + 4 };
                     });
                 }
              }, 100);
            }
            return () => { clearInterval(clientGenRef.current); clearInterval(gameLoopRef.current); };
          }, [gameState, grillStatus, toasterStatus, fritesStatus, prepStatus, menuStatus, showHelp, explanationTarget, isPaused, clients]);

          const startGrill = () => { if (grillStatus.state === 'empty') { spawnMovingItem('steak_raw'); setTimeout(() => setGrillStatus({ state: 'cooking', progress: 0 }), 800); }};
          const startToaster = () => { if (toasterStatus.state === 'empty') { spawnMovingItem('bun_raw'); setTimeout(() => setToasterStatus({ state: 'cooking', progress: 0 }), 800); }};
          const startFrites = () => { if (fritesStatus.state === 'empty') { spawnMovingItem('fries_raw'); setTimeout(() => setFritesStatus({ state: 'cooking', progress: 0 }), 800); }};

          const resetGame = (target) => {
            setGameState(target); setIsPaused(false); setScore(0); setBurgersMade(0);
            setGrillStatus({ state: 'empty', progress: 0 }); setToasterStatus({ state: 'empty', progress: 0 });
            setFritesStatus({ state: 'empty', progress: 0 }); setPrepStatus({ state: 'empty', progress: 0 });
            setMenuStatus({ state: 'empty', progress: 0 }); setClients(3); setMovingItems([]);
          };

          const renderSimulationBoard = () => (
            <div className="max-w-6xl mx-auto select-none">
              
              {showHelp && (
                  <div className="fixed inset-0 bg-black/60 z-50 flex items-center justify-center backdrop-blur-sm">
                      <div className="bg-white p-6 rounded-xl max-w-md shadow-2xl border-4 border-slate-200">
                          <h3 className="font-bold text-xl mb-4 flex items-center gap-2"><Icon name="HelpCircle"/> Flux de Production (Lean)</h3>
                          <ul className="list-disc pl-5 space-y-2 text-sm text-slate-700">
                              <li><strong>Stocks Séparés :</strong> Chambre Froide (Bas) et Sec (Haut).</li>
                              <li><strong>Grill & Toaster :</strong> Production vers la table centrale.</li>
                              <li><strong>Table de Préparation :</strong> Assemblage final (Viande + Pain).</li>
                              <li><strong>Runner :</strong> Consolidation du menu.</li>
                          </ul>
                          <button onClick={()=>setShowHelp(false)} className="mt-6 w-full bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg font-bold">Compris</button>
                      </div>
                  </div>
              )}

              {explanationTarget && (
                  <div className="fixed inset-0 bg-black/60 z-50 flex items-center justify-center backdrop-blur-sm">
                      <div className="bg-white p-6 rounded-xl max-w-md shadow-2xl border-t-4 border-blue-500">
                          <h3 className="font-bold text-xl mb-2 text-slate-800">{STATION_STANDARDS[explanationTarget].title}</h3>
                          <div className="bg-blue-50 p-4 rounded-lg mb-4">
                            <ul className="list-disc pl-5 text-sm space-y-1 text-blue-900">
                                {STATION_STANDARDS[explanationTarget].content.map((c,i)=><li key={i}>{c}</li>)}
                            </ul>
                          </div>
                          <button onClick={()=>setExplanationTarget(null)} className="w-full bg-slate-800 hover:bg-slate-700 text-white px-4 py-2 rounded-lg font-bold">Fermer</button>
                      </div>
                  </div>
              )}

              {/* HUD (Sans Timer) */}
              <div className="flex justify-between items-center mb-4 bg-slate-800 text-white p-3 rounded-xl shadow-lg border border-slate-700">
                <div className="flex gap-4 items-center">
                    <div className="bg-slate-700 px-4 py-2 rounded-lg flex gap-2 items-center border border-slate-600">
                        <Icon name="Tray" size={18} className="text-green-300"/> 
                        <span className="font-mono text-xl font-bold">{burgersMade}</span>
                    </div>
                </div>
                <div className="flex gap-4 items-center">
                     <span className="font-bold text-yellow-400 text-2xl drop-shadow-md">{score} pts</span>
                     <button onClick={() => setShowHelp(true)} className="p-2 hover:bg-slate-700 rounded-full transition-colors"><Icon name="HelpCircle" size={24} className="text-slate-400 hover:text-white"/></button>
                </div>
              </div>

              {feedback && (
                  <div className="absolute top-24 left-1/2 transform -translate-x-1/2 z-50 animate-bounce">
                      <div className="bg-red-500 text-white px-6 py-2 rounded-full font-bold shadow-lg border-2 border-white">{feedback.msg}</div>
                  </div>
              )}

              {/* PLAN DE MASSE */}
              <div className={`relative w-full h-[600px] border-4 border-slate-700 rounded-xl overflow-hidden shadow-2xl flex bg-slate-900 ${isPaused ? 'grayscale blur-sm' : ''}`}>
                 
                 {isPaused && (
                     <div className="absolute inset-0 z-[100] flex items-center justify-center bg-black/40">
                         <button onClick={() => setIsPaused(false)} className="bg-yellow-500 text-white px-8 py-3 rounded-full font-bold shadow-xl flex items-center gap-2 hover:scale-105 transition transform border-4 border-white">
                             <Icon name="Play" size={24} fill="currentColor"/> REPRENDRE
                         </button>
                     </div>
                 )}

                 {/* ZONE CUISINE (80%) */}
                 <div className="w-[80%] h-full bg-floor-kitchen relative border-r-4 border-slate-600">
                    <div className="absolute inset-0 bg-pattern-kitchen pointer-events-none"></div>
                    <div className="absolute top-2 left-2 text-slate-400 font-bold text-xs tracking-widest uppercase border border-slate-300 px-2 py-0.5 rounded bg-white/50 backdrop-blur-sm">
                        Cuisine (Back of House)
                        <button onClick={() => setExplanationTarget('layout_general')} className="ml-2 bg-blue-100 text-blue-600 px-2 py-0.5 rounded-full text-[10px] hover:bg-blue-200 transition-colors inline-flex items-center gap-1 border border-blue-200">
                            <Icon name="Layout" size={10}/> Organisation
                        </button>
                    </div>

                    {/* --- SVG FLUX AU SOL (Ajusté pour connexion G/D + Nouveau Layout) --- */}
                    <svg className="absolute inset-0 w-full h-full pointer-events-none z-0 opacity-20" viewBox="0 0 1000 600" preserveAspectRatio="none">
                        <defs><marker id="arrow" markerWidth="10" markerHeight="10" refX="9" refY="3" orient="auto"><path d="M0,0 L0,6 L9,3 z" fill="#333" /></marker></defs>
                        
                        {/* 1. Stock Sec (Top G) -> Toaster (Top Col 2) */}
                        <path d="M100,100 L220,100" fill="none" stroke="#333" strokeWidth="2" strokeDasharray="5,5" markerEnd="url(#arrow)" />

                        {/* 2. Chambre Froide (Mid G) -> Grill (Mid Col 2) */}
                        <path d="M100,300 L220,300" fill="none" stroke="#333" strokeWidth="2" strokeDasharray="5,5" markerEnd="url(#arrow)" />

                        {/* 3. Chambre Froide (Mid G) -> Frites (Bot Col 2) */}
                        <path d="M100,300 Q150,500 220,500" fill="none" stroke="#333" strokeWidth="2" strokeDasharray="5,5" markerEnd="url(#arrow)" />

                        {/* 4. Toaster (Top Col 2) -> Prep (Top Center) */}
                        <path d="M352,100 Q400,100 470,220" fill="none" stroke="#333" strokeWidth="3" markerEnd="url(#arrow)" />

                        {/* 5. Grill (Mid Col 2) -> Prep (Mid Center) */}
                        <path d="M352,300 Q400,300 470,280" fill="none" stroke="#333" strokeWidth="3" markerEnd="url(#arrow)" />

                        {/* 6. Frites (Bot Col 2) -> Runner (Bot Right) */}
                        <path d="M352,500 Q550,500 750,280" fill="none" stroke="#333" strokeWidth="2" markerEnd="url(#arrow)" />

                        {/* 7. Prep (Center) -> Runner (Right) */}
                        <path d="M662,250 L750,240" fill="none" stroke="#333" strokeWidth="2" markerEnd="url(#arrow)" />

                         {/* 8. Runner (Right) -> Counter (Far Right) */}
                        <path d="M885,240 L935,240" fill="none" stroke="#333" strokeWidth="2" markerEnd="url(#arrow)" />
                    </svg>

                    {/* --- ZONES STOCKAGE SÉPARÉES (Alignement Gauche) --- */}
                    
                    {/* 1. Stockage Sec (Haut) */}
                    <div className="absolute top-[10%] left-[2%] w-28 h-28 bg-amber-100 border-4 border-amber-300 rounded-xl shadow-lg flex flex-col items-center justify-center z-10 hover:scale-105 transition-transform">
                        <div className="absolute right-[-4px] top-1/2 transform -translate-y-1/2 w-2 h-2 bg-slate-400 rounded-full border border-white z-0"></div>
                        <div className="text-[9px] font-bold text-amber-900 uppercase mb-2 text-center">Stockage<br/>Sec</div>
                        <Icon name="Package" size={32} className="text-amber-600 mb-2"/>
                        <button onClick={() => setExplanationTarget('stock_dry')} className="absolute top-1 right-1 text-amber-500 hover:text-amber-700"><Icon name="Info" size={14}/></button>
                    </div>

                    {/* 2. Chambre Froide (Bas) */}
                    <div className="absolute top-[40%] bottom-[10%] left-[2%] w-28 bg-blue-100 border-4 border-blue-300 rounded-xl shadow-lg flex flex-col items-center justify-center z-10 hover:scale-105 transition-transform">
                        <div className="absolute right-[-4px] top-1/2 transform -translate-y-1/2 w-2 h-2 bg-slate-400 rounded-full border border-white z-0"></div>
                        <div className="text-[9px] font-bold text-blue-900 uppercase mb-2 text-center">Chambre<br/>Froide</div>
                        <Icon name="Snowflake" size={32} className="text-blue-500 mb-2"/>
                        <button onClick={() => setExplanationTarget('stock_cold')} className="absolute top-1 right-1 text-blue-500 hover:text-blue-700"><Icon name="Info" size={14}/></button>
                    </div>

                    {/* --- POSTES DE PRODUCTION (Colonne 2) --- */}
                    
                    {/* 1. Toaster (Haut - Aligné avec Stock Sec) */}
                    <div className="absolute top-[10%] left-[22%] w-32 h-24 bg-white border border-gray-400 shadow-xl flex flex-col z-20 rounded-md overflow-hidden">
                        <div className="bg-slate-100 border-b border-gray-300 p-1 text-[9px] font-bold text-center uppercase tracking-wider text-slate-600">Toaster Vertical</div>
                        <div className="flex-1 p-1">
                             <SimulationStation name="Toasting Pain" iconName="Box" color="bg-yellow-500" type="toaster" className="w-full h-full" status={toasterStatus.state} progress={toasterStatus.progress} onClick={startToaster} onShowStandard={() => setExplanationTarget('toaster')} showInfoButton={true}/>
                        </div>
                    </div>

                    {/* 2. Grill (Milieu - Aligné avec Chambre Froide Haut) */}
                    <div className="absolute top-[40%] left-[22%] w-32 h-24 bg-white border border-gray-400 shadow-xl flex flex-col z-20 rounded-md overflow-hidden">
                        <div className="bg-slate-100 border-b border-gray-300 p-1 text-[9px] font-bold text-center uppercase tracking-wider text-slate-600">Grill Clamshell</div>
                        <div className="flex-1 p-1">
                             <SimulationStation name="Cuisson Viande" iconName="Flame" color="bg-red-500" type="grill" className="w-full h-full" status={grillStatus.state} progress={grillStatus.progress} onClick={startGrill} onShowStandard={() => setExplanationTarget('grill')} showInfoButton={true}/>
                        </div>
                    </div>

                    {/* 3. Frites (Bas - Aligné avec Chambre Froide Bas) */}
                    <div className="absolute top-[75%] left-[22%] w-32 h-24 bg-white border-2 border-yellow-200 shadow-lg flex flex-col z-20 rounded-lg overflow-hidden">
                         <div className="bg-yellow-50 border-b border-yellow-200 p-1 text-[9px] font-bold text-center uppercase text-yellow-800">Station Frites</div>
                         <div className="flex-1 p-1">
                            <SimulationStation name="Cuisson Frites" iconName="Waves" color="bg-yellow-400" type="frites" className="w-full h-full" status={fritesStatus.state} progress={fritesStatus.progress} onClick={startFrites} onShowStandard={() => setExplanationTarget('frites')} showInfoButton={true}/>
                        </div>
                    </div>

                    {/* --- CENTRE --- */}

                    {/* Table de Préparation (Centrée) */}
                    <div className="absolute top-[35%] left-[48%] w-44 h-32 bg-white border border-gray-400 shadow-2xl flex flex-col z-20 rounded-md overflow-hidden">
                        <div className="bg-slate-100 border-b border-gray-300 p-1 text-[9px] font-bold text-center uppercase tracking-wider text-slate-600">Table de Préparation</div>
                        <div className="flex-1 p-1">
                             <SimulationStation name="Assemblage Burger" iconName="Sandwich" color="bg-green-500" type="assembly" className="w-full h-full" status={prepStatus.state} progress={prepStatus.progress} onClick={handlePrepAssembly} onShowStandard={() => setExplanationTarget('assembly')} showInfoButton={true}/>
                        </div>
                    </div>

                    {/* --- DROITE --- */}

                    {/* Constitution Menu / Runner */}
                    <div className="absolute top-[35%] left-[75%] w-36 h-32 bg-white border border-gray-400 shadow-2xl flex flex-col z-20 rounded-md overflow-hidden">
                        <div className="bg-slate-100 border-b border-gray-300 p-1 text-[9px] font-bold text-center uppercase tracking-wider text-slate-600">Constitution Menu</div>
                        <div className="flex-1 p-1">
                             <SimulationStation name="Runner / Plateau" iconName="Tray" color="bg-purple-500" type="menu" className="w-full h-full" status={menuStatus.state} progress={menuStatus.progress} onClick={handleRunnerAssembly} onShowStandard={() => setExplanationTarget('menu')} showInfoButton={true}/>
                        </div>
                    </div>
                 </div>

                 {/* ZONE RESTAURATION (20%) */}
                 <div className="w-[20%] h-full bg-floor-dining relative flex flex-col">
                    <div className="absolute top-2 right-2 text-amber-800 font-bold text-xs tracking-widest uppercase border border-amber-800/20 px-2 py-0.5 rounded bg-white/50">Salle</div>

                    {/* COMPTOIR REMISE */}
                    <div className="h-[25%] w-full bg-white border-b-4 border-slate-600 flex flex-col items-center justify-center shadow-lg z-30 relative">
                        <div className="absolute bottom-0 left-0 w-full h-2 bg-slate-200"></div>
                        
                        {/* Point de connexion GAUCHE (Arrivée depuis Runner) */}
                        <div className="absolute left-[-4px] top-1/2 transform -translate-y-1/2 w-2 h-2 bg-slate-400 rounded-full border border-white z-0"></div>

                        <h4 className="font-bold text-slate-700 text-xs uppercase mb-2 border-b-2 border-slate-200 pb-1">Comptoir</h4>
                        <div className="w-16 h-12 border-2 border-dashed border-slate-300 rounded bg-slate-50 flex items-center justify-center text-[8px] text-slate-400 text-center leading-tight">
                            Remise
                        </div>
                        <button onClick={() => setExplanationTarget('counter')} className="absolute top-1 right-1 text-slate-400 hover:text-slate-600"><Icon name="Info" size={12}/></button>
                    </div>

                    {/* FILE D'ATTENTE */}
                    <div className="flex-1 p-2 flex flex-col items-center relative overflow-hidden bg-gradient-to-b from-transparent to-black/5">
                        <div className="absolute inset-0 flex flex-col items-center justify-start pt-4 opacity-10 pointer-events-none">
                            <div className="w-0.5 h-full bg-amber-900/30 border-l border-dashed border-amber-900"></div>
                        </div>
                        <h5 className="text-[9px] font-bold text-amber-900 uppercase mb-4 bg-amber-100 px-2 py-0.5 rounded-full shadow-sm">File</h5>
                        
                        <div className="w-full flex flex-col gap-2 items-center">
                            {Array.from({length: clients}).map((_, i) => (
                                <div key={i} className={`w-full max-w-[100px] p-1.5 rounded-lg flex items-center gap-2 shadow-md transition-all duration-500 ${i===0 ? 'bg-green-50 border-l-4 border-green-500 scale-105 z-10' : 'bg-white/80 border border-amber-200 opacity-70 scale-95'}`}>
                                    <div className={`w-6 h-6 rounded-full flex items-center justify-center shadow-sm ${i===0?'bg-green-500 text-white':'bg-gray-200 text-gray-500'}`}>
                                        <Icon name="User" size={14}/>
                                    </div>
                                    <div className="flex-1">
                                        <div className="h-1 bg-gray-200 rounded w-full mb-1"></div>
                                        <div className="h-1 bg-gray-200 rounded w-2/3"></div>
                                    </div>
                                </div>
                            ))}
                            {clients === 0 && <div className="text-[8px] text-amber-800 italic mt-10 text-center bg-white/50 p-1 rounded">Vide</div>}
                        </div>
                    </div>
                 </div>

                 {/* --- ANIMATIONS DE FLUX (ICÔNES MOBILES) --- */}
                 {movingItems.filter(i => i.type === 'steak_raw').map(item => (
                     <div key={item.id} className="absolute z-50 animate-stock-to-grill pointer-events-none">
                         <div className="bg-red-500 p-2 rounded-full shadow border border-white" title="Steak"><Icon name="Flame" size={16} className="text-white"/></div>
                     </div>
                 ))}
                 {movingItems.filter(i => i.type === 'bun_raw').map(item => (
                     <div key={item.id} className="absolute z-50 animate-stock-to-toaster pointer-events-none">
                         <div className="bg-yellow-400 p-2 rounded-full shadow border border-white" title="Pain"><Icon name="Box" size={16} className="text-yellow-900"/></div>
                     </div>
                 ))}
                 {movingItems.filter(i => i.type === 'fries_raw').map(item => (
                     <div key={item.id} className="absolute z-50 animate-stock-to-fry pointer-events-none">
                         <div className="bg-yellow-200 p-2 rounded-full shadow border border-white" title="Frites"><Icon name="Waves" size={16} className="text-yellow-600"/></div>
                     </div>
                 ))}
                 
                 {/* Assemblage */}
                 {movingItems.filter(i => i.type === 'parts_to_prep').map(item => (
                    <React.Fragment key={item.id}>
                        <div className="absolute z-50 animate-grill-to-prep pointer-events-none">
                            <div className="bg-amber-800 p-2 rounded-full shadow border border-white"><Icon name="Flame" size={16} className="text-white"/></div>
                        </div>
                        <div className="absolute z-50 animate-toaster-to-prep pointer-events-none">
                            <div className="bg-yellow-500 p-2 rounded-full shadow border border-white"><Icon name="Box" size={16} className="text-white"/></div>
                        </div>
                    </React.Fragment>
                 ))}
                 
                 {/* Garniture (Visuel) */}
                 {movingItems.filter(i => i.type === 'garnish_to_prep').map(item => (
                    <div key={item.id} className="absolute z-50 animate-garnish-to-prep pointer-events-none flex gap-1">
                        <div className="bg-red-500 w-4 h-4 rounded-full shadow border border-white"></div>
                        <div className="bg-green-500 w-4 h-4 rounded-full shadow border border-white"></div>
                    </div>
                 ))}

                 {/* Vers Runner */}
                 {movingItems.filter(i => i.type === 'burger_to_runner').map(item => (
                     <div key={item.id} className="absolute z-50 animate-burger-to-runner pointer-events-none">
                         <div className="bg-orange-100 p-2 rounded-full border-2 border-orange-500 shadow-xl"><Icon name="Sandwich" size={20} className="text-orange-600"/></div>
                     </div>
                 ))}
                 {movingItems.filter(i => i.type === 'fries_to_runner').map(item => (
                     <div key={item.id} className="absolute z-50 animate-fries-to-runner pointer-events-none">
                         <div className="bg-yellow-100 p-2 rounded-full border-2 border-yellow-500 shadow-xl"><Icon name="Waves" size={20} className="text-yellow-600"/></div>
                     </div>
                 ))}

                 {/* Final (Plateau) */}
                 {movingItems.filter(i => i.type === 'tray_final').map(item => (
                     <div key={item.id} className="absolute z-50 animate-tray-to-counter pointer-events-none">
                         <div className="bg-purple-600 p-2 rounded-lg shadow-xl border-2 border-white flex gap-1 items-center justify-center">
                             <Icon name="Sandwich" size={16} className="text-white"/>
                             <Icon name="Waves" size={16} className="text-yellow-200"/>
                         </div>
                     </div>
                 ))}

              </div>
            </div>
          );

          const renderIntro = () => (
             <div className="text-center max-w-2xl mx-auto space-y-6 mt-12 animate-fade-in-up">
                <div className="bg-slate-800 text-white p-10 rounded-3xl shadow-2xl border-b-8 border-slate-900">
                    <div className="flex justify-center mb-4">
                        <div className="bg-white p-4 rounded-full shadow-lg">
                            <Icon name="ChefHat" size={48} className="text-red-600"/>
                        </div>
                    </div>
                    <h1 className="text-5xl font-extrabold tracking-tight mb-2">BURGER FLOW</h1>
                    <p className="text-xl text-yellow-400 font-medium">Simulation de Production Lean Management</p>
                </div>
                
                <div className="flex justify-center">
                     <button onClick={() => resetGame('simulation')} className="group bg-white hover:bg-red-50 text-slate-800 p-8 rounded-2xl font-bold text-xl shadow-lg border-2 border-transparent hover:border-red-500 transition-all flex flex-col items-center gap-4">
                         <div className="bg-red-100 p-4 rounded-full group-hover:bg-red-500 group-hover:text-white transition-colors">
                            <Icon name="Play" size={40}/>
                         </div>
                         <span>Lancer la Production</span>
                         <span className="text-xs text-gray-400 font-normal">Gérez les flux en temps réel</span>
                     </button>
                </div>
             </div>
          );

          const renderHeader = () => (
             <header className="max-w-6xl mx-auto mb-6 flex justify-between items-center bg-white px-6 py-3 rounded-xl shadow-sm border border-slate-100">
                 <div className="font-extrabold text-slate-800 flex items-center gap-3 text-lg tracking-tight">
                    <div className="bg-red-500 p-1.5 rounded-lg text-white">
                        <Icon name="ChefHat" size={20}/> 
                    </div>
                    BURGER FLOW
                 </div>
                 <div className="flex gap-3">
                     {gameState === 'simulation' && (
                         <button onClick={() => setIsPaused(!isPaused)} className={`px-4 py-2 rounded-lg font-bold text-sm transition-colors flex items-center gap-2 ${isPaused ? 'bg-green-100 text-green-700 hover:bg-green-200' : 'bg-slate-100 text-slate-700 hover:bg-slate-200'}`}>
                            {isPaused ? <Icon name="Play" size={16}/> : <Icon name="Pause" size={16}/>} 
                            {isPaused ? 'Reprendre' : 'Pause'}
                         </button>
                     )}
                     <button onClick={() => resetGame('intro')} className="px-4 py-2 bg-slate-100 rounded-lg hover:bg-slate-200 flex gap-2 items-center text-sm font-bold text-slate-600 transition-colors">
                        <Icon name="Home" size={16}/> Accueil
                     </button>
                 </div>
             </header>
          );

          return (
            <div className="min-h-screen p-4 font-sans text-slate-800 bg-slate-50 pb-20">
              {renderHeader()}
              {gameState === 'intro' && renderIntro()}
              {gameState === 'simulation' && renderSimulationBoard()}
              {gameState === 'end' && (
                  <div className="text-center mt-20 animate-fade-in-up">
                      <div className="inline-block bg-white p-12 rounded-3xl shadow-2xl border-t-8 border-blue-500">
                          <h2 className="text-4xl font-bold mb-4 text-slate-800">Fin de service</h2>
                          <div className="text-6xl font-extrabold text-blue-600 mb-2">{score} <span className="text-2xl text-gray-400">pts</span></div>
                          <p className="text-gray-500 mb-8 text-lg">Menus servis : {burgersMade}</p>
                          <button onClick={()=>resetGame('intro')} className="bg-slate-800 hover:bg-slate-900 text-white px-10 py-4 rounded-xl font-bold text-lg shadow-lg transition-transform hover:scale-105 flex items-center gap-2 mx-auto">
                              <Icon name="Home" size={20}/> Retour au Menu
                          </button>
                      </div>
                  </div>
              )}
            </div>
          );
        }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<BurgerFactoryApp />);
    </script>
</body>
</html>